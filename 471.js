(self.webpackChunk=self.webpackChunk||[]).push([[471],{3427:(e,t,n)=>{var r=n(8081),s=n(3645),o=n(1667),a=n(9677),i=n(2819),l=s(r),c=o(a),d=o(i);l.push([e.id,"#translate-panel{background-color:#f5f8fa;display:flex;flex-direction:column;padding-bottom:8px}.bp3-dark #translate-panel{background-color:#293742}#translate-panel .fixed{flex-shrink:0;margin-bottom:10px}#translate-panel .body{flex-grow:1;overflow:auto;overscroll-behavior:contain}#translate-panel .body::-webkit-scrollbar{width:8px;background-color:rgba(0,0,0,0);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar:hover{background-color:rgba(0,0,0,0.09)}#translate-panel .body::-webkit-scrollbar-thumb:vertical{background:rgba(0,0,0,0.5);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar-thumb:vertical:active{background:rgba(0,0,0,0.61);-webkit-border-radius:100px}#translate-panel.size-small,#translate-panel.size-small h6.bp3-heading,#translate-panel.size-small .bp3-control.bp3-large,#translate-panel.size-small textarea.bp3-input.bp3-small{font-size:14px}#translate-panel.size-small .phonetic-item,#translate-panel.size-small .quick-settings a{font-size:12px}#translate-panel.size-middle,#translate-panel.size-middle h6.bp3-heading,#translate-panel.size-middle .bp3-control.bp3-large,#translate-panel.size-middle textarea.bp3-input{font-size:18px}#translate-panel.size-middle .phonetic-item,#translate-panel.size-middle .quick-settings a{font-size:14px}#translate-panel.size-large,#translate-panel.size-large h6.bp3-heading,#translate-panel.size-large .bp3-control.bp3-large,#translate-panel.size-large textarea.bp3-input.bp3-large{font-size:22px}#translate-panel.size-large .source,#translate-panel.size-large .phonetic-item,#translate-panel.size-large .quick-settings a{font-size:18px}#translate-panel .bp3-button.bp3-small,#translate-panel .bp3-small .bp3-button{min-height:20px;min-width:20px}#translate-panel .header{display:flex;align-items:center;padding:4px 6px 4px 10px;border-bottom:1px solid #d1d1d1}.bp3-dark #translate-panel .header{border-bottom-color:rgba(16,22,26,0.4)}#translate-panel .header .drag-block{min-width:5px;flex-shrink:0;flex-grow:1;align-self:stretch}#translate-panel .header .left{flex-shrink:0;display:flex}#translate-panel .header .right{flex-shrink:0;display:flex;align-items:center}#translate-panel .header .right .bp3-icon-arrow-right{flex-shrink:0;margin:0 5px}#translate-panel .header .right>.bp3-button{flex-shrink:0;margin:0 1px}#translate-panel .header .right>.bp3-button:last-child{margin-right:0}#translate-panel .quick-settings{padding:4px 9px;margin:0 1px}#translate-panel .quick-settings>div{margin-bottom:5px}#translate-panel .quick-settings .bp3-control{margin-bottom:0}#translate-panel .query-text{position:relative;padding:10px 10px 2px 10px}#translate-panel .query-text textarea.bp3-input{min-height:44px;font-family:system-ui, -apple-system, 'Segoe UI', 'Roboto', 'Ubuntu', 'Cantarell', 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';overscroll-behavior:contain}#translate-panel .query-text .translate-btn{position:absolute;opacity:0.6}#translate-panel .query-text .translate-btn:hover{opacity:1}#translate-panel .body{padding:0 10px}#translate-panel .body .bp3-card:first-child{margin-top:1px}#translate-panel .body .bp3-card:last-child{margin-bottom:1px}#translate-panel .body .no-api{margin:20px 0}.result-block{margin:8px 0;padding:2px 5px}.result-block .bp3-button{visibility:hidden}.result-block .error .bp3-button,.result-block:hover .bp3-button{visibility:visible}.result-block .legend{display:flex;align-items:center;justify-content:space-between}.result-block .legend .legend-left{display:flex;align-items:center}.result-block .legend .api-ico,.result-block .legend .bp3-heading{flex-shrink:0;white-space:nowrap}.result-block .legend .api-ico{display:inline-block;width:14px;height:14px;background-size:contain;margin-right:3px}.result-block .legend .bp3-heading{margin-bottom:0;margin-right:10px}.result-block .legend .source{cursor:pointer;font-size:12px;display:inline-flex;align-items:center}.result-block .legend .source .source-text{overflow:hidden}.result-block .legend .source .bp3-icon{position:relative;top:-1px;margin-left:1px}.result-block .phonetic{display:flex;flex-wrap:wrap}.result-block .phonetic .phonetic-item{display:flex;align-items:center;font-size:12px}.result-block .phonetic .phonetic-item:not(:last-child){margin-right:12px}.result-block .common-result p{line-height:1.3;margin:2px 0;overflow-wrap:break-word}.result-block .common-result .dict a{text-decoration:underline}.result-block .error{font-size:12px;padding:5px 10px}.result-block .dict-pos{margin-right:5px}.external-translators{margin-bottom:3px;padding:0;display:flex;flex-wrap:wrap}.external-translators>div{margin:0 5px 5px 0}.quick-links a{margin:0 5px 5px 0}#popper-container{width:250px;max-width:100%;position:absolute;left:0;top:0;z-index:9999999998;touch-action:none;transition:opacity 0.2s;background-color:#f5f8fa}.bp3-dark #popper-container{background-color:#293742}#popper-container.show{opacity:1;pointer-events:auto;user-select:auto}#popper-container,#popper-container[data-popper-reference-hidden='true']{opacity:0;pointer-events:none;user-select:none}#popper-container .drag-block{cursor:grab}#popper-container.pin{position:fixed}#popper-container.pin .arrow{display:none}#popper-container .arrow,#popper-container .arrow::before{position:absolute;width:8px;height:8px;z-index:-1}#popper-container .arrow::before{content:'';transform:rotate(45deg);background:#f5f8fa}.bp3-dark #popper-container .arrow::before{background-color:#293742}#popper-container .arrow{display:none}#popper-container.show[data-popper-placement]:not([data-popper-reference-hidden='true']) .arrow{display:block}#popper-container[data-popper-placement^='top'] .arrow{bottom:-5px}#popper-container[data-popper-placement^='top'] .arrow::before{border-right:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#popper-container[data-popper-placement^='bottom'] .arrow{top:-5px}#popper-container[data-popper-placement^='bottom'] .arrow::before{border-left:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^='left'] .arrow{right:-5px}#popper-container[data-popper-placement^='left'] .arrow::before{border-right:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^='right'] .arrow{left:-5px}#popper-container[data-popper-placement^='right'] .arrow::before{border-left:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#translate-btn{display:none;position:absolute;z-index:9999999999;left:0;top:0}#translate-btn .bp3-button{padding:2px;min-width:0;min-height:0}#translate-btn .btn-icon{width:18px;height:18px;background-image:url("+c+");background-size:contain}.bp3-dark #translate-btn .btn-icon{background-image:url("+d+")}#translate-btn.show{display:block}.translate-type-selector .bp3-label{display:inline}.translate-type-selector .bp3-radio{margin-bottom:0}#ocr-container{position:fixed;z-index:99999999999999;left:0;top:0;right:0;bottom:0}#ocr-container .toolbar{display:none;position:absolute;z-index:1}#ocr-container img{max-width:100%}#app{cursor:default}.switch-pin{flex-shrink:0;cursor:pointer}.switch-pin .bp3-icon-pin{transition:transform 0.2s, color 0.2s;transform:rotate(-45deg)}.pin .switch-pin .bp3-icon-pin{transform:rotate(-70deg)}.cut-btn{margin-left:2px}.app-toaster-container{position:fixed !important;z-index:9999999999 !important}.app-toaster-container .bp3-toast{min-width:auto}#web-trs-panel .app-toaster-container{padding-right:0}\n",""]),e.exports=l},5059:(e,t,n)=>{var r=n(8081),s=n(3645)(r);s.push([e.id,"#root{-webkit-text-size-adjust:100%;box-sizing:border-box;font-size:14px;font-weight:400;letter-spacing:0;line-height:1.28581;text-transform:none;color:#182026;font-family:-apple-system, 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Open Sans', 'Helvetica Neue', 'Icons16', sans-serif}#root{touch-action:manipulation}#root>.bp3-portal{z-index:9999999999}\n",""]),e.exports=s},5650:(e,t,n)=>{var r=n(8081),s=n(3645)(r);s.push([e.id,"hcfy-result{display:none}hcfy-result.__hcfy__result__loading__.__hcfy__result__result__{display:inline-block}hcfy-result.__hcfy__result__loaded__:focus{border-color:transparent;outline:2px solid !important}hcfy-result.__hcfy__result__loaded____hcfy__result__source__{display:none}hcfy-result.__hcfy__result__loaded__.__hcfy__result__both__{display:block}hcfy-result.__hcfy__result__loaded__.__hcfy__result__both__.__hcfy__result__inline__{display:inline-block;margin-left:6px}hcfy-result.__hcfy__result__loaded__.__hcfy__result__result__{display:inline-block}\n",""]),e.exports=s},9677:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=n.p+"logo.png"},2819:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=n.p+"logowhite36.png"},7658:(e,t,n)=>{var r=n(3427);r&&r.__esModule&&(r=r.default),e.exports="string"==typeof r?r:r.toString()},3543:(e,t,n)=>{var r=n(5059);r&&r.__esModule&&(r=r.default),e.exports="string"==typeof r?r:r.toString()},2709:(e,t,n)=>{var r=n(5650);r&&r.__esModule&&(r=r.default),e.exports="string"==typeof r?r:r.toString()},4185:(e,t,n)=>{"use strict";n.d(t,{pB:()=>o,C:()=>a,UR:()=>i});var r=n(3281),s=n(6372);const o=[s.Lx,r.Ty],a={"default-speech":s.zr,TencentRealtime:r.Uz},i={"default-speech":s.Xn,TencentRealtime:r.PK}},8270:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Pt});var r=n(3150),s=n.n(r),o=n(7294),a=n(5787),i=n(4184),l=n.n(i),c=n(966),d=n(3036),u=n(2541);const p="static"!==getComputedStyle(document.documentElement).position;var h=n(9916),m=n.n(h);function f(){return{edges:{left:!0,right:!0,bottom:!1,top:!1},modifiers:[m().modifiers.restrictSize({min:{width:250,height:100}})]}}function g(e){if(!e||!e.startsWith("translate"))return null;const t=e.startsWith("translate3d"),n=e.replace("translate"+(t?"3d":""),"").match(/-?\d+(\.\d+)?/g);if(!n)return null;const r=Number(n[0]),s=Number(n[1]);return Number.isNaN(r)||Number.isNaN(s)?null:{x:r,y:s,is3d:t}}function v(e){return`translate${e.is3d?"3d":""}(${Math.round(e.x)}px,${Math.round(e.y)}px${e.is3d?",0":""})`}var y=n(1922),E=n(1515),b=n(9970),w=n(1227),x=n.n(w);function T(e,t){switch(t.type){case"overload":return t.payload;case"incremental":if(!e||!t.payload.placement)return e;const n=g(e.transform);if(!n)throw new Error("未解析到箭头的位置信息");return t.payload.placement.startsWith("bottom")||t.payload.placement.startsWith("top")?n.x=n.x-t.payload.x:(t.payload.placement.startsWith("left")||t.payload.placement.startsWith("right"))&&(n.y=n.y-t.payload.y),{...e,transform:v(n)}}}var C=n(1109),_=n(4063),k=n.n(_),S=n(1627),N=n(8438);function L(e,t){const n=e.pos;switch(t.type){case"setWidth":const r=e.width,s=t.payload;return r===s?e:{...e,width:s};case"readWidth":return t.payload(e.width),e;case"setPosSafe":const{pos:o,containerWidth:a=0,containerHeight:i=0}=t.payload,l=(0,S.Q)(document.documentElement),c=(0,N.L)()||0;let d=o.x;const u=d+a-(window.innerWidth-(l.v?c:0));u>0&&(d-=u),d<0&&(d=0);let h=o.y;if(i){const e=h+i-(window.innerHeight-(l.h?c:0));e>0&&(h-=e)}return h<0&&(h=0),d===n.x&&h===n.y?null==e.otherStyles?e:{...e,otherStyles:null}:{...e,pos:{x:d,y:h,is3d:n.is3d},otherStyles:null};case"readPos":return t.payload(e.pos),e;case"importPopperStyles":const m=t.payload,f={pos:g(m.transform)||{x:0,y:0,is3d:!1},otherStyles:m};return k()(f,(0,E.Z)(e,["pos","otherStyles"]))?e:{...e,...f};case"incrementalPos":const{dx:v,dy:y}=t.payload;return 0===v&&0===y?e:{...e,pos:{x:n.x+v,y:n.y+y,is3d:n.is3d}};case"switch2fixed":const{pageXOffset:b,pageYOffset:w}=window,x={...e,otherStyles:null};return p||0===b&&0===w||(x.pos={x:n.x-b,y:n.y-w,is3d:n.is3d}),x;default:return e}}const R=x()("popperContainer"),P=(0,E.Z)(b.q,["width","pinPos","pinAfterDrag"]),O=(0,o.forwardRef)((function(e,t){const{pin:n,setPin:r,range:s,show:a,placement:i,setMaxHeight:h}=e,[g,b]=(0,o.useState)(!1);(0,o.useEffect)((()=>{a&&b(!1)}),[a]),(0,o.useEffect)((()=>{n||b(!1)}),[n]);const w=(0,o.useRef)(null),x=(0,o.useRef)(null),_=(0,o.useMemo)((()=>a&&!n&&s?s:null),[s,a,n]),[k,S]=(0,o.useReducer)(L,{width:P.width,pos:{x:0,y:0,is3d:!1},otherStyles:null}),[N,O]=(0,y.Z)(P),z=N?N.width:P.width,I=e=>{R("保存窗口宽度",e),O({width:e})};(0,o.useEffect)((()=>{R("同步 storage 中的宽度",z),S({type:"setWidth",payload:z})}),[z]);const A=N?N.pinPos:P.pinPos,F=e=>{const t=e&&(0,E.Z)(e,["x","y"]);R("保存窗口位置",t),O({pinPos:t})},M=()=>{n?S({type:"readPos",payload:F}):R("保存窗口位置时由于不是 pin 状态，取消保存")},U=(0,o.useCallback)((()=>{var e,t;A&&(R("设置窗口位置"),S({type:"setPosSafe",payload:{pos:A,containerWidth:null===(e=w.current)||void 0===e?void 0:e.clientWidth,containerHeight:null===(t=w.current)||void 0===t?void 0:t.clientHeight}}))}),[A]);(0,o.useEffect)((()=>{if(n&&a)return U(),window.addEventListener("resize",U),()=>{window.removeEventListener("resize",U)}}),[U,n,a]);const[Z,D]=(0,o.useReducer)(T,null),{realtimePlacement:B,updatePopper:H,popperStyles:W,popperAttrs:K,arrowStyles:q,maxSizeObj:Y}=function(e,t,n,r){const{styles:s,attributes:o,update:a,state:i}=(0,d.D)(e,t,{placement:r,strategy:p?"fixed":void 0,modifiers:[{name:"arrow",options:{element:n}},{name:"computeStyles",options:{adaptive:!1}},{name:"offset",options:{offset:[0,12]}},u.Z]});return{realtimePlacement:e&&(null==i?void 0:i.placement)||null,updatePopper:e?a:null,popperStyles:e?s.popper:null,popperAttrs:e?o.popper:null,arrowStyles:e?s.arrow:null,maxSizeObj:e&&(null==i?void 0:i.modifiersData.maxSize)||null}}(_,w.current,x.current,i);(0,o.useEffect)((()=>{D({type:"overload",payload:q})}),[q]),(0,o.useEffect)((()=>{!n&&Y&&h(Y.height)}),[Y,n,h]),(0,C.Z)((()=>{W&&(R("导入 popperjs 的样式",W),S({type:"importPopperStyles",payload:W}))}),[W]);const $=function(e,t,n,r){const[s,a]=(0,o.useState)(null),[i,l]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{if(!e)return;const t=m()(e);return t.resizable({...f(),onstart(){l(!0)}}),a(t),()=>{t.unset(),a(null)}}),[e]),(0,o.useEffect)((()=>{if(!s)return;let e;if(t){const n=t.indexOf("-");switch(e=n>0?t.slice(0,n):t,e){case"top":e="bottom";break;case"bottom":e="top";break;case"left":e="right";break;case"right":e="left"}if("top"===e||"bottom"===e)return}const n=f();e&&(n.edges[e]=!1),s.set({resize:n})}),[t,s]),(0,o.useEffect)((()=>{if(!s)return;const e=function(e){n(e.rect.width,e.deltaRect.left,e.deltaRect.top)};return s.on("resizemove",e),()=>{s.off("resizemove",e)}}),[n,s]),(0,o.useEffect)((()=>{if(!s)return;const e=function(){l(!1),r()};return s.on("resizeend",e),()=>{s.off("resizeend",e)}}),[s,r]),i}(w.current,B,((e,t,n)=>{S({type:"setWidth",payload:e}),S({type:"incrementalPos",payload:{dx:t,dy:n}}),D({type:"incremental",payload:{x:t,y:n,placement:B}})}),(()=>{S({type:"readWidth",payload:I}),M()}));!function(e,t,n,r,s){const[a,i]=(0,o.useState)(null),[l,c]=(0,o.useState)(!1);(0,o.useEffect)((()=>{if(!e)return;const n=e.querySelector(t);if(!n)return;const r=m()(n);return r.draggable(!0).styleCursor(!1),i(r),()=>{r.unset(),i(null)}}),[e,t]),(0,o.useEffect)((()=>{if(!a)return;const e=()=>{c(!0),n()};return a.on("dragstart",e),()=>{a.off("dragstart",e)}}),[a,n]),(0,o.useEffect)((()=>{if(!a)return;const e=e=>{r(e.dx,e.dy)};return a.on("dragmove",e),()=>{a.off("dragmove",e)}}),[a,r]),(0,o.useEffect)((()=>{if(!a)return;const e=()=>{c(!1),s()};return a.on("dragend",e),()=>{a.off("dragend",e)}}),[a,s])}(w.current,".drag-block",(0,o.useCallback)((()=>{b(!0),(null==(null==N?void 0:N.pinAfterDrag)?P.pinAfterDrag:N.pinAfterDrag)&&r((e=>(e||(R("拖拽过程中将窗口转为固定模式位置"),S({type:"switch2fixed"})),!0)))}),[r,null==N?void 0:N.pinAfterDrag]),((e,t)=>{S({type:"incrementalPos",payload:{dx:e,dy:t}})}),(()=>{M()})),(0,o.useImperativeHandle)(t,(()=>({switch2pin(){R("主动调用 switch2pin 方法转为固定模式"),S({type:"switch2fixed"}),M()},clearPos(){R("由于转为了非固定模式，所以清空了 storage 里的位置"),F(null),window.setTimeout((()=>{H&&H()}))}})));const j=(0,o.useMemo)((()=>{const e={...k.otherStyles,width:k.width,transform:v(k.pos)};return R("合成 container 样式",e),e}),[k]);return o.createElement("div",{id:"popper-container",ref:w,style:j,...K,className:l()({show:a,pin:n},"bp3-elevation-4")},o.createElement(c.z_,{onResize:()=>{n&&a&&!$&&U()}},e.children),!g&&o.createElement("div",{className:"arrow",ref:x,style:Z||void 0}))}));n(9320);var z=n(6983),I=n(2054),A=n(935),F=n(3937),M=n(9554),U=n(5977),Z=n(2630),D=n(473),B=n(8172),H=n(7176),W=n(3500),K=n(1587),q=n(1520),Y=n(5487),$=n(8028),j=n(2088),V=n(6006);const J=(0,E.Z)(b.q,"secondDestinationLatestSource","selectedAPIs","collapsedAPIs","selectedExternalLinks","source","destination","autoPlay","autoCopy","recentUseLangFrom","recentUseLangTo","sourceTransformNCaml","sourceTransformNoBr","sourceTransformNoComment","sourceTransformRegExps","tipPanelSettingsClosed","historyEnabled","favoritesEnabled","quickLinks","tipQuickLinksClosed","panelCustomStyle","customAPINames","panelSize","panelButtons","textAreaAuto"),X=(0,E.Z)(b.d,["user","noticesUnreadNum"]),Q={small:14,middle:18,large:22},G=(0,o.forwardRef)((function(e,t){const{toaster:n,headerLeft:r,headerRight:a,extendOptions:i,showTextArea:l=!1,size:d="small",style:u,hasDragTip:p,portalContainer:h,showOptionsTip:m=!0}=e,[f,g,v]=(0,y.Z)(J),[b]=(0,y.Z)(X),w=(null==b?void 0:b.user)||null,x=(0,o.useMemo)((()=>{const e=null==f?void 0:f.selectedAPIs,t=null==f?void 0:f.customAPINames;if(e&&t)return(null==w?void 0:w.forever)?[...e,...t]:e}),[null==f?void 0:f.customAPINames,null==f?void 0:f.selectedAPIs,null==w?void 0:w.forever]),T=(0,o.useMemo)((()=>{const e=null==f?void 0:f.collapsedAPIs;return e&&e.length?(0,B.ZP)(x,(t=>{t&&e.forEach((e=>{const n=t.indexOf(e);n>=0&&t.splice(n,1)}))})):x}),[x,null==f?void 0:f.collapsedAPIs]),C=(null==f?void 0:f.quickLinks.filter((e=>e.panel)))||[],_=f||J,k=Q[d],S="small"===d,N="large"===d,L=(null==f?void 0:f.source)||"",R=(0,o.useCallback)((e=>{g({source:e})}),[g]),[P,O]=(0,o.useState)(""),[G,ee]=(0,o.useState)(""),te=P===G,ne=(0,o.useRef)(null),[re,se]=(0,o.useState)(!1),{results:oe,queryResult:ae,dispatchResults:ie}=(0,Z.n)(G,T,L,null==f?void 0:f.destination),[le,ce]=(0,o.useState)([]),[,de]=(0,M.Z)(),{isInFavorites:ue,saveOrDelete:pe}=(0,D.Z)(G,ie,T),he=(0,q._)(n),{sourceTransformNCaml:me,sourceTransformNoBr:fe,sourceTransformNoComment:ge,sourceTransformRegExps:ve}=(null==w?void 0:w.vipActivated)?(0,E.Z)(f||J,["sourceTransformNCaml","sourceTransformNoBr","sourceTransformNoComment","sourceTransformRegExps"]):{sourceTransformNCaml:!1,sourceTransformNoBr:!1,sourceTransformNoComment:!1,sourceTransformRegExps:[]},ye=(0,o.useRef)(""),Ee=(0,o.useCallback)((e=>{if(e===ye.current)return;ye.current=e,ce((e=>(0,B.ZP)(e,(e=>{e.splice(0)}))));const t=(0,V.L)(e,{sourceTransformNCaml:me,sourceTransformNoBr:fe,sourceTransformNoComment:ge,sourceTransformRegExps:ve});O(t),ee(t)}),[me,fe,ge,ve]),be=(0,o.useRef)(Ee);be.current=Ee;const we=(0,H.Z)(G);(0,o.useEffect)((()=>{_.historyEnabled&&we!==G&&G&&de({type:"save translate record",text:G})}),[de,G,_.historyEnabled]),(0,o.useEffect)((()=>{_.secondDestinationLatestSource&&we!==G&&G&&(0,j.e)(G).then((e=>{null!=e&&"中文(简体)"!==e&&s().storage.local.set({latestSource:e})}))}),[G,_.secondDestinationLatestSource]),(0,o.useImperativeHandle)(t,(()=>({select(){var e;null===(e=ne.current)||void 0===e||e.select()},async play(){var e,t;if(!x)return;const n=x[0],r=null===(e=oe.results[n])||void 0===e?void 0:e.result;return n&&(null==r?void 0:r.text)===ye.current?(0,z.h)({apiId:n,source:r.from,text:r.text,ttsURI:(null===(t=r.phonetic)||void 0===t?void 0:t[0].ttsURI)||r.ttsURI}):void 0},async translate(e,t){if(await v,"text"===e.type)be.current(e.text),t&&this.select();else if("image"===e.type)return he(e.dataURI).then((e=>{be.current(e),t&&this.select()}))}})),[he,v,oe.results,x]);const xe=(0,o.useMemo)((()=>S?{width:6,height:6,borderRadius:3,right:3,top:1}:N?{width:10,height:10,borderRadius:5,right:8,top:6}:{width:8,height:8,borderRadius:4,right:5,top:3}),[N,S]),Te=o.createElement(c.zx,{icon:o.createElement(c.JO,{icon:"cog",iconSize:k}),small:S,large:N,minimal:!0,active:re,className:"settings",onClick:()=>{se((e=>!e))},title:"快捷设置"});return o.createElement(o.Fragment,null,(null==f?void 0:f.panelCustomStyle)&&o.createElement("style",null,f.panelCustomStyle),o.createElement("div",{id:"translate-panel",className:"size-"+d,style:u},o.createElement("div",{className:"fixed"},o.createElement("div",{className:"header"},o.createElement("div",{className:"left"},r,(null==f?void 0:f.panelButtons.includes("media"))&&o.createElement(Y.j,{isSmall:S,isLarge:N,iconSize:k,onSelect:e=>{he(e).then(Ee,I.Z)},portalContainer:h}),(null==f?void 0:f.panelButtons.includes("microphone"))&&o.createElement($.k,{isSmall:S,isLarge:N,iconSize:k,onSelect:Ee,portalContainer:h}),(null==f?void 0:f.panelButtons.includes("folder-open"))&&o.createElement(c.zx,{small:S,large:N,minimal:!0,icon:o.createElement(c.JO,{icon:"folder-open",iconSize:k}),onClick:()=>{s().runtime.sendMessage({action:"open options page",suffix:"#/stars"})},title:"打开收藏夹"}),(null==f?void 0:f.panelButtons.includes("history"))&&o.createElement(c.zx,{small:S,large:N,minimal:!0,icon:o.createElement(c.JO,{icon:"history",iconSize:k}),onClick:()=>{s().runtime.sendMessage({action:"open options page",suffix:"#/history"})},title:"打开历史记录"})),o.createElement("div",{className:"drag-block",title:p?"按住不放可以拖动":void 0}),o.createElement("div",{className:"right"},!!le.length&&o.createElement(c.zx,{icon:o.createElement(c.JO,{icon:"undo",iconSize:k}),small:S,large:N,minimal:!0,title:"返回上一次翻译",onClick:()=>{const e=(0,A.Z)(le);e&&(O(e),ee(e)),ce((e=>(0,B.ZP)(e,(e=>{e.pop()}))))}}),!!(null==b?void 0:b.noticesUnreadNum)&&o.createElement("div",{style:{fontSize:0,position:"relative"}},o.createElement(c.zx,{icon:o.createElement(c.JO,{icon:"notifications",iconSize:k}),small:S,large:N,minimal:!0,title:`你有 ${b.noticesUnreadNum} 条未读消息`,onClick:()=>{s().runtime.sendMessage({action:"open options page",suffix:"?notices"})}}),o.createElement("div",{style:{position:"absolute",background:"rgb(243,1,1)",...xe}})),f&&o.createElement(o.Fragment,null,f.favoritesEnabled&&o.createElement(c.zx,{icon:o.createElement(c.JO,{icon:ue?"star":"star-empty",iconSize:k}),disabled:!G,small:S,large:N,minimal:!0,title:ue?"从收藏夹中删除":"添加到收藏夹",onClick:pe}),f.tipPanelSettingsClosed&&Te,!f.tipPanelSettingsClosed&&o.createElement(c.J2,{enforceFocus:!1,content:o.createElement("div",{className:"bp3-text-small",style:{width:"200px",padding:"5px"}},"添加 / 隐藏翻译源、语种切换、鼠标悬浮取词开关和显示翻译文本开关在这里。",o.createElement("a",{onClick:()=>{g({tipPanelSettingsClosed:!0})}},"不再提示")),canEscapeKeyClose:!1,isOpen:!f.tipPanelSettingsClosed&&m,portalContainer:h},Te)),a)),o.createElement(c.UO,{isOpen:re,keepChildrenMounted:!0},o.createElement(U.Z,{source:L,setSource:R,options:f,setOptions:g,user:w,size:d,portalContainer:h},i)),l&&o.createElement(K.H,{isLarge:N,isSmall:S,iconSize:k,value:P,onChange:O,onTranslate:e=>{Ee(null==e?P:e)},ref:ne,hideBtn:te||!P,auto:(null==f?void 0:f.textAreaAuto)||!1})),o.createElement("div",{className:"body",style:te?void 0:{opacity:.7}},!G&&o.createElement("p",null,"请输入需要翻译的文本。"),G&&f&&(null==x?void 0:x.map(((e,t)=>{const n=oe.results[e];return o.createElement(z.Z,{portalContainer:h,key:e,apiId:e,result:n,size:d,queryResult:t=>{ae(G,e,t||L)},autoPlay:f.autoPlay&&0===t,autoCopy:!!(null==w?void 0:w.vipActivated)&&f.autoCopy&&0===t,setQuery:e=>{ce((e=>(0,B.ZP)(e,(e=>{e.push(G)})))),ee(e),O(e)},collapse:f.collapsedAPIs.includes(e),onCollapseChange:()=>{g((t=>{const n=t.collapsedAPIs.indexOf(e);n>=0?t.collapsedAPIs.splice(n,1):t.collapsedAPIs.push(e)}))}})}))),x&&!x.length&&o.createElement(c.tR,{className:"no-api",title:"你隐藏了所有翻译源",description:"请添加一个翻译源来显示翻译结果。",action:o.createElement(c.J2,{portalContainer:h,content:o.createElement(c.v2,null,o.createElement(F.Z,null))},o.createElement(c.zx,{icon:"add",small:S,large:N,text:"添加翻译源"}))}),!!(null==f?void 0:f.selectedExternalLinks.length)&&o.createElement("div",{className:"external-translators"},f.selectedExternalLinks.map((e=>{const t=W.F.find((t=>t.id===e));return t?o.createElement("div",{key:e},o.createElement(c.AN,{small:S,large:N,text:t.name,target:"_blank",href:t.generateLink(G,f.destination,L)})):null}))),f&&!f.tipQuickLinksClosed&&G&&o.createElement(c.UW,{style:{marginBottom:8,fontSize:12}},"下方是预定义的三个快捷链接，你可以前往",o.createElement("a",{onClick:()=>{s().runtime.sendMessage({action:"open options page",suffix:"#/panel"})}},"“设置” - “翻译面板”")," ","- “快捷链接”中修改或删除它们。",o.createElement("a",{onClick:()=>{g({tipQuickLinksClosed:!0})}},"不再提示")),!!C.length&&G&&o.createElement("div",{className:"quick-links"},C.map((e=>o.createElement("a",{key:e.name,href:e.link.replace("%s",encodeURIComponent(G)),target:"_blank",rel:"noreferrer"},e.name)))))))})),ee=function(e){e.preventDefault()},te=(0,E.Z)(b.q,["buttonAutoClose","buttonOffsetTop","buttonOffsetLeft"]);function ne(e){const{btnPos:t,setBtnPos:n,onBtnClick:r}=e,s=t?"show":void 0,[a]=(0,y.Z)(te),i=(0,o.useRef)(),[l,d]=(0,o.useState)(!1),u=t?{transform:`translate(${t.x+10-((null==a?void 0:a.buttonOffsetLeft)||0)}px,${t.y+10-((null==a?void 0:a.buttonOffsetTop)||0)}px)`}:void 0;return(0,o.useEffect)((()=>{if(!(null==a?void 0:a.buttonAutoClose))return d(!1),void window.clearTimeout(i.current);t?l?window.clearTimeout(i.current):i.current=window.setTimeout((()=>{n(null)}),2e3):(d(!1),window.clearTimeout(i.current))}),[t,l,n,null==a?void 0:a.buttonAutoClose]),o.createElement("div",{id:"translate-btn",className:s,style:u,onPointerDown:ee,onPointerEnter:()=>{d(!0)},onPointerLeave:()=>{d(!1)}},o.createElement(c.zx,{icon:o.createElement("span",{className:"btn-icon"}),onClick:r}))}var re=n(7255),se=n(7643);function oe(e){const t=e.match(/^(([^:]+):\/\/)?([^/]+)?(\/.*)?$/);if(!t)return;let n=t[3]||"";const r=n.indexOf(":");r>=0&&(n=n.slice(0,r));let s=t[4]||"";const o=s.indexOf("#");if(o>=0&&(s=s.slice(0,o)),!n.startsWith(".")){if(!s){if(!n)return;s="/"}return{host:n,path:s}}}function ae(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace("*",".*").replace(/^\.\*\\\./,"(.*\\.)?")+"$").test(t)}function ie(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".*")+"$").test(t)}function le(e,t,n){let r,s;r="string"==typeof e?oe(e):e;let o=!1,a=!1;if(r){const e=e=>{const t=function(e,t){let n;if(n="string"==typeof t?oe(t):t,n)return ae(e.host,n.host)&&ie(e.path,n.path)}(e,r);return t&&(s=e),t};o=n.some(e),o||(a=t.some(e))}return{urlParts:r,matchedRule:s,whiteListMatched:o,blackListMatched:a}}var ce=n(807),de=n(2852),ue=n(5840),pe=n(6749),he=n(6072),me=n(6654);const fe=x()("detector master");function ge(e){const t=e.selection;let n=null;if(t){const r=t.text,s=t.event;let o,a,i;if("function"==typeof t.rect)o=t.rect(),a={getBoundingClientRect:t.rect},i=s?{x:s.clientX+e.path[0].scrollLeft,y:s.clientY+e.path[0].scrollTop}:null;else{i=s?{x:s.clientX,y:s.clientY}:null;const n=e.path;o=(0,E.Z)(t.rect,["top","left","width","height","right","bottom"]),(0,ue.Z)(n,(e=>{if(e.rect&&e.computedStyles){const t=e.rect.left+e.computedStyles.paddingLeft+e.computedStyles.borderLeftWidth,n=e.rect.top+e.computedStyles.paddingTop+e.computedStyles.borderTopWidth;o.left+=t,o.top+=n,i&&(i.x+=t,i.y+=n)}})),o.right=o.left+o.width,o.bottom=o.top+o.height,a={getBoundingClientRect:()=>o};const r=(0,A.Z)(e.path);i=i?{x:i.x+r.scrollLeft,y:i.y+r.scrollTop}:null}n={text:r,mouseUpEvent:s,isTop:t.isTop,isInTextarea:t.isInTextarea,isInContentEditable:t.isInContentEditable,range:a,btnPos:i}}return{parsedData:n,activeFrameIndex:e.path.map((e=>e.frameIndex))}}var ve=n(3129),ye=n.n(ve),Ee=n(5976),be=n(985);const we=(0,E.Z)(b.q,["localOCR"]);function xe(e){const{imgSrc:t,isShow:n,setIsShow:r,onText:s,isLocalOCR:a,portalContainer:i}=e,[l,d]=(0,y.Z)(we),u=(0,o.useRef)(null),p=(0,o.useRef)(),h=(0,o.useRef)(null),[m,f]=(0,o.useState)(null);return(0,o.useLayoutEffect)((()=>{if(!n)return;const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}),[n]),(0,o.useLayoutEffect)((()=>{if(!n||!u.current)return;const e=u.current,t=new(ye())(u.current,{viewMode:1,guides:!1,center:!1,minContainerWidth:e.clientWidth,minContainerHeight:e.clientHeight,autoCrop:!1,movable:!1,rotatable:!1,scalable:!1,zoomable:!1,zoomOnTouch:!1,zoomOnWheel:!1,cropstart(){f(null)},cropend(){const e=t.getCropBoxData();f({left:-9999,top:-9999}),window.setTimeout((()=>{var t;f({left:e.left+e.width-((null===(t=h.current)||void 0===t?void 0:t.clientWidth)||0),top:e.top+e.height+5})}))}});return p.current=t,()=>{f(null),t.destroy(),p.current=void 0}}),[n]),(0,o.useEffect)((()=>{if(!n)return;const e=e=>{27===e.keyCode&&(e.stopPropagation(),r(!1))};return window.addEventListener("keyup",e,!0),()=>{window.removeEventListener("keyup",e,!0)}}),[r,n]),n?o.createElement("div",{id:"ocr-container"},o.createElement("div",{ref:h,className:"toolbar",style:{display:m?"block":"none",left:null==m?void 0:m.left,top:null==m?void 0:m.top}},o.createElement(c.zx,{onClick:()=>{var e;if(!window.isSecureContext)return void window.alert("受限于浏览器的安全策略，复制截图只能在 https 网站使用。");if(!(null===(e=navigator.clipboard)||void 0===e?void 0:e.write))return void window.alert(be.XO?"复制截图的功能需要在 Chrome 66 / Edge 79 及以上的版本中才能使用。":"Firefox 浏览器暂时不支持复制截图，请在别的浏览器上使用。");const t=p.current;t&&t.getCroppedCanvas({imageSmoothingEnabled:!1}).toBlob((e=>{e&&navigator.clipboard.write([new ClipboardItem({[e.type]:e})]).then((()=>{r(!1)}),(e=>{window.alert("复制失败，错误消息："+e.message)}))}))}},"复制截图"),a&&o.createElement(Ee.U,{value:(null==l?void 0:l.localOCR.lang)||we.localOCR.lang,onChange:e=>{d((t=>{t.localOCR.lang=e}))},portalContainer:i}),o.createElement(c.zx,{onClick:()=>r(!1)},"取消 (Esc)"),o.createElement(c.zx,{onClick:()=>{const e=p.current;if(!e)return;const t=e.getCroppedCanvas().toDataURL(),n=e.getCropBoxData();s(t,n),r(!1)}},"确定")),o.createElement("img",{ref:u,src:t,alt:"屏幕截图"})):null}var Te=n(9025),Ce=n(9203);class _e{constructor(e){this.stream=[],this.streamTextLength=0,this.queue=[],this.handling=!1,this.apiCode=e}addStream(e){const t=e.text.length;t&&(this.streamTextLength+t>3e3&&(this.queue.push(this.stream),this.stream=[],this.streamTextLength=0,this.handleTask()),this.stream.push(e),this.streamTextLength+=t,window.setTimeout((()=>{this.handleTask()}),500))}handleTask(){if(this.handling)return;let e=this.queue.shift();if(!e){if(!this.stream.length)return;e=this.stream,this.stream=[],this.streamTextLength=0}this.handling=!0;const t=[],n=[];e.forEach((e=>{const r=e.text.split("\n").map((e=>e.trim())).filter(Ce.Z);n.push({start:t.length,end:t.length+r.length}),t.push(...r)})),s().runtime.sendMessage({action:"translate",data:{apiCode:this.apiCode,text:t.join("\n")}}).then((t=>{var r;let s;if(t.result)s=t.result;else{const e=null===(r=t.dict)||void 0===r?void 0:r[0].terms[0];e&&(s=[e])}const o=t.error;e.forEach(((e,t)=>{if(o)return void e.reject(new Error(o.message));if(!s)return void e.reject(new Error("没有翻译结果"));const r=n[t],a=r.end-r.start,i=s.slice(r.start,r.end);e.resolve(i.length===a?i.join("\n"):null)})),this.handling=!1}),(t=>{e.forEach((e=>{e.reject(t)})),this.handling=!1})).then((()=>{this.handleTask()}))}}var ke=n(4001);const Se=be.un?2e3:500;function Ne(e){(0,o.useLayoutEffect)((()=>{if(!e)return;e.style.transform=`translateX(${e.clientWidth}px)`,e.style.transition="none";let t,n=!1;setTimeout((()=>{n||(e.style.transition="transform 0.2s")}),200);const r=()=>{null!=t&&clearTimeout(t)},s=()=>{r(),e.style.transform=""},o=()=>{var n;n=Se,r(),t=setTimeout((()=>{e.style.transform=`translateX(${e.clientWidth}px)`}),n)};return e.addEventListener("mouseenter",s),e.addEventListener("mouseleave",o),()=>{n=!0,r(),e.style.transform="",e.style.transition="",e.removeEventListener("mouseenter",s),e.removeEventListener("mouseleave",o)}}),[e])}function Le(){const e=document.body.childNodes;return 1===e.length&&e[0]instanceof HTMLPreElement}class Re{constructor(e,t=ke.U.source,n){let r;if(n)r=n;else{if(!Le())throw new TypeError("当前页面不是 txt 文件。");r=document.body.firstElementChild}this.preElement=r,this.showType=ke.U.source,this.originText=r.textContent||"",this.originParagraphs=this.originText.split(/\n{2,}/),this.resultParagraphs=[],this.originParagraphs.forEach(((t,n)=>{const r=t.replace(/\n/g," ").trim();r?(this.resultParagraphs[n]="正在翻译，请稍候……",e(r).then((e=>{this.resultParagraphs[n]=e||"",this.renderResult()}))):this.resultParagraphs[n]=""})),this.switchShowType(t)}renderResult(){switch(this.showType){case ke.U.source:this.preElement.textContent=this.originText;break;case ke.U.result:this.preElement.textContent=this.resultParagraphs.join("\n\n");break;case ke.U.both:this.preElement.textContent=this.originParagraphs.reduce(((e,t,n)=>t.trim()?e+t+"\n【译文】"+this.resultParagraphs[n]+"\n\n":e),"")}}switchShowType(e){this.showType!==e&&(this.showType=e,this.renderResult())}destroy(){this.switchShowType(ke.U.source),this.destroyed=!0}}class Pe{constructor(e,t,n){this.rootNode=e,this.staticChildNodes=t,this.translateNodes=[],this.translateFn=n}add(e,t){const{rootNode:n,staticChildNodes:r,translateNodes:s,translateFn:o}=this,a=r.slice(e,t+1),i=new ke.o(n,a,o);return s.push(i),i}translate(){this.translateNodes.forEach((e=>e.translate()))}setOnlyChild(){var e;null===(e=this.translateNodes[0])||void 0===e||e.setOnlyChild()}switchShowType(e){this.translateNodes.forEach((t=>t.switchShowType(e)))}destroy(){this.translateNodes.forEach((e=>e.destroy()))}}const Oe=["base","head","link","meta","style","body","hr","pre","br","area","audio","img","map","track","video","embed","iframe","object","param","picture","portal","source","svg","math","canvas","noscript","script","input","meter","progress","textarea","select"],ze=["article","aside","footer","header","h1","h2","h3","h4","h5","h6","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","li","ol","p","ul","details","dialog","menu","summary","form","table","thead","tbody","tr","th","td","center","label"].concat(Oe);function Ie(e){return e.nodeType===Node.ELEMENT_NODE}function Ae(e){const t=e.tagName.toLowerCase();return ze.includes(t)||t.includes("-")}function Fe(e){const t=e.tagName.toLowerCase();return"button"===e.getAttribute("role")?!Oe.includes(t):"button"===t||"a"===t}function Me(e,t,n=(()=>!1),r){const s={element:e,paragraphs:[],children:[]};if(e instanceof Element&&n(e))return s;if(e instanceof Element){const o=e.shadowRoot;if(o){const e=Me(o,t,n,r);s.children.push(e)}}let o;const a=Array.from(e.childNodes);let i=!1;const l=a.filter((e=>{var t;if(e.nodeType===Node.TEXT_NODE){const n=!!(null===(t=e.nodeValue)||void 0===t?void 0:t.trim());return n&&(i=!0),n}return e.nodeType===Node.ELEMENT_NODE})),c=e=>a.indexOf(l[e]);if(l.forEach(((d,u)=>{if(null==o&&(o=u),Ie(d)&&(Ae(d)||function(e,t,n){const r=e[t];if(!Ie(r))return!1;const s=e[t-1],o=e[t+1];if(Fe(r)&&!n){if(s&&Ie(s)&&Fe(s))return!0;if(o&&Ie(o)&&Fe(o))return!0}return s?Ie(s)&&Ae(s):!o||Ie(o)&&Ae(o)}(l,u,i))){const i=u-1;if(i>=o){const n=c(o),r=c(i);s.paragraphs.push([n,r]),null==t||t(e,a,n,r)}if(o=void 0,!function(e){if(Fe(e))return!1;const t=e.tagName.toLowerCase();return Oe.includes(t)}(d)&&!n(d)){const e=Me(d,t,n,r);s.children.push(e)}}})),null!=o){const n=l.length-1,r=c(o),i=c(n);s.paragraphs.push([r,i]),null==t||t(e,a,r,i)}return 1===s.paragraphs.length&&0===s.children.length&&(null==r||r(s)),s}class Ue{constructor(e){this.translateFn=e,this.text=document.title,this.translateResult="",this.translating=!1,this.translated=!1,this.showType=ke.U.source,this.destroyed=!1}destroy(){document.title=this.text,this.destroyed=!0}switchShowType(e){if(!this.destroyed){switch(e){case ke.U.both:document.title=`${this.text} ~ ${this.translateResult}`;break;case ke.U.source:document.title=this.text;break;case ke.U.result:document.title=this.translateResult}this.showType=e}}async translate(){if(this.destroyed||!this.text||this.translating||this.translated)return;let e;this.translating=!0,this.translateResult="正在翻译……",this.switchShowType(this.showType);try{e=await this.translateFn(this.text)}catch(e){return this.translating=!1,this.translated=!0,this.translateResult="翻译出错："+e.message,void this.switchShowType(this.showType)}if(this.translating=!1,null==e)return this.translate();this.translated=!0,this.translateResult=e,this.switchShowType(this.showType)}}var Ze=n(2709),De=n.n(Ze),Be=n(7147);const He=document.createElement("style");He.textContent="hcfy-result.__hcfy__result__loaded__.__hcfy__result__both__{border: 1px dotted}";const We=(0,E.Z)(b.q,["pageTrsHighlight"]);let Ke;(0,Be.Z)(We,(e=>{e.pageTrsHighlight?document.head.appendChild(He):document.head.contains(He)&&document.head.removeChild(He)}));let qe,Ye={x:0,y:0};const $e=e=>{const t=e.target;qe&&qe!==t&&(qe.contentEditable="false"),"hcfy-result"===t.nodeName.toLowerCase()&&(Ke=t,Ye={x:e.pageX,y:e.pageY})},je=e=>{if(!Ke)return;const t=e.target;t===Ke&&Ye.x===e.pageX&&Ye.y===e.pageY&&(t.contentEditable="true",t.focus(),qe=t),Ke=void 0};const Ve=(0,E.Z)(b.q,["pageTrsEditable"]);(0,Be.Z)(Ve,(e=>{e.pageTrsEditable?(window.addEventListener("pointerdown",$e),window.addEventListener("pointerup",je)):(qe&&(qe.contentEditable="false"),window.removeEventListener("pointerdown",$e),window.removeEventListener("pointerup",je))}));let Je=()=>{Je=I.Z;const e=document.createElement("style");e.textContent=De(),document.head.appendChild(e)};function Xe(e){const t=e.nodeName.toLowerCase();return"body"!==t&&"html"!==t}function Qe(e){return Array.prototype.some.call(e.childNodes,(e=>e.nodeType===Node.COMMENT_NODE&&"hcfy-anchor"===e.nodeValue))}class Ge{constructor(e,t=ke.U.both,n=document.body){this.groups=new Map,this.mutationObserver=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{Ie(e)&&!function(e,t){let n=e;do{if(t(n))return!0;n=n.parentElement}while(n&&Xe(n));return!1}(e,(e=>{const t=e.tagName.toLowerCase();return"pre"===t||"hcfy-result"===t||(!!Qe(e)||void 0)}))&&this.analysis(e)})),e.removedNodes.forEach((e=>{if(Ie(e)){const t=e=>{this.groups.delete(e),Array.prototype.forEach.call(e.children,t)};t(e)}}))}))})),this.intersectionObserver=new IntersectionObserver((e=>{e.forEach((e=>{if(0===e.intersectionRatio)return;const t=this.groups.get(e.target);t&&t.translate()}))}),{rootMargin:`${window.screen.availHeight*window.devicePixelRatio}px ${window.screen.availWidth*window.devicePixelRatio}px`}),Je(),this.translateFn=e,this.showType=t,this.titleNode=new Ue(e),this.titleNode.switchShowType(t),this.titleNode.translate(),this.analysis(n);const r=document.getElementsByTagName("sr-read")[0];r&&this.analysis(r),this.mutationObserver.observe(n,{childList:!0,subtree:!0})}analysis(e){const{groups:t,translateFn:n}=this;Me(e,((e,r,s,o)=>{let a=t.get(e);a||(a=new Pe(e,r,n),t.set(e,a),e instanceof Element&&this.intersectionObserver.observe(e));a.add(s,o).switchShowType(this.showType)}),(e=>"hcfy-result"===e.tagName.toLowerCase()||Qe(e)),(e=>{const n=t.get(e.element);n&&n.setOnlyChild()}))}switchShowType(e){this.showType=e,this.titleNode.switchShowType(e);for(const t of this.groups.values())t.switchShowType(e)}destroy(){this.intersectionObserver.disconnect(),this.mutationObserver.disconnect(),this.titleNode.destroy();for(const e of this.groups.values())e.destroy()}}function et(e){const{children:t,portalContainer:n,showTip:r,clearTip:s}=e;return r?o.createElement(c.u,{isOpen:!0,portalContainer:n,placement:"left",content:o.createElement("div",{style:{width:180}},"可以在这里切换翻译服务和双语 / 原文 / 译文。",o.createElement("a",{onClick:s},"不再提示"))},t):o.createElement(o.Fragment,null,t)}var tt=n(9784);const nt=[{name:"双语",value:ke.U.both},{name:"原文",value:ke.U.source},{name:"译文",value:ke.U.result}],rt=s().runtime.getURL("/logo.png");function st(){s().runtime.sendMessage({action:"open options page",suffix:"#/fulltext"})}const ot={...(0,E.Z)(b.q,["pageTrsApiOptions","customAPINames","tipForSlowDeepLPageTrsClosed","tipForPageTrsClosed"]),...(0,E.Z)(b.d,["user","tipForShortKeyForPageTrsTypeClosed","tipForAddJumpTwoClosed"])};function at(e){var t;const{apiCode:n,showType:r,onShowTypeChange:a,onAPIChange:i,auto:l,onAutoChange:d,portalContainer:u}=e,[p,h]=(0,y.Z)(ot),m=(0,o.useMemo)((()=>{var e;let t=(null==p?void 0:p.pageTrsApiOptions)||ot.pageTrsApiOptions;t.includes(n)||(t=t.concat(n));const r=tt.L.filter((e=>t.includes(e.id)));if(null===(e=null==p?void 0:p.user)||void 0===e?void 0:e.forever){const e=((null==p?void 0:p.customAPINames)||ot.customAPINames).map((e=>({id:e,name:e})));if(e.length)return[...r,...e]}return r}),[null==p?void 0:p.pageTrsApiOptions,null==p?void 0:p.customAPINames,null===(t=null==p?void 0:p.user)||void 0===t?void 0:t.forever,n]),[f,g]=(0,o.useState)(null),[v,E]=(0,o.useState)(null);(0,o.useEffect)((()=>{if(f)return E(f.closest(".bp3-toast")),()=>{E(null)}}),[f]),Ne(v);const b=!!p&&!p.tipForPageTrsClosed;return o.createElement(o.Fragment,null,o.createElement(c.zx,{elementRef:g,style:{position:"absolute",width:30,left:-30,top:0,bottom:0,padding:"0 3px"}},o.createElement(et,{portalContainer:u,showTip:b,clearTip:b?()=>{h({tipForPageTrsClosed:!0})}:void 0},o.createElement("img",{src:rt,style:{width:"100%"},alt:"展开"}))),o.createElement("div",null,o.createElement(c.Lu,{value:n,onChange:e=>{const t=e.currentTarget.value;i(t)}},m.map((e=>"BingDictWeb"===e.id?null:o.createElement("option",{key:e.id,value:e.id},e.name)))),"DeepLWeb"===n&&p&&!p.tipForSlowDeepLPageTrsClosed&&o.createElement(c.UW,{intent:"warning"},"DeepL 速度较慢，请耐心等待。",o.createElement("a",{onClick:()=>{h({tipForSlowDeepLPageTrsClosed:!0})}},"不再提示"))),o.createElement("div",null,o.createElement(c.hE,null,nt.map((e=>o.createElement(c.zx,{key:e.value,active:r===e.value,onClick:()=>{e.value!==r&&a(e.value)},text:e.name})))),p&&!p.tipForShortKeyForPageTrsTypeClosed&&o.createElement(c.UW,{style:{width:160}},"你可以用快捷键来切换双语 / 原文 / 译文。",o.createElement("div",null,o.createElement("a",{onClick:()=>{s().runtime.sendMessage({action:"open options page"})},style:{marginRight:15}},"前往设置"),o.createElement("a",{onClick:()=>{h({tipForShortKeyForPageTrsTypeClosed:!0})}},"不再提示"))),p&&!p.tipForAddJumpTwoClosed&&o.createElement(c.UW,{style:{width:160}},"切换双语 / 原文 / 译文的快捷键现在可以选择【跳过双语】了。",o.createElement("div",null,o.createElement("a",{onClick:()=>{s().runtime.sendMessage({action:"open options page"})},style:{marginRight:15}},"前往设置"),o.createElement("a",{onClick:()=>{h({tipForAddJumpTwoClosed:!0})}},"不再提示")))),o.createElement(c.XZ,{style:{margin:0},inline:!0,label:"在当前窗口自动开启",checked:l,onChange:e=>{d(e.target.checked)}}),o.createElement("div",null,o.createElement("a",{onClick:st},"打开设置")))}const it=new Te.P("pageTranslateLimit",3),lt={...(0,E.Z)(b.q,["pageTrsApi"]),...(0,E.Z)(b.d,["pageTrsType"])},ct=(0,E.Z)(b.q,["pageTrsJumpTwo"]);function dt(e){const{open:t,setOpen:n,portalContainer:r}=e,{pageTrsAuto:a,setPageTrsAuto:i}=function(e){const[t,n]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{s().runtime.sendMessage({action:"is auto page translate"}).then((t=>{n(t),e(t)}))}),[]),(0,o.useEffect)((()=>{const e=e=>{"auto page translate"===e.action&&n(e.value)};return s().runtime.onMessage.addListener(e),()=>{s().runtime.onMessage.removeListener(e)}}),[]),{pageTrsAuto:t,setPageTrsAuto:(0,o.useCallback)((e=>{n((t=>(t!==e&&s().runtime.sendMessage({action:e?"add auto page translate":"remove auto page translate"}),e)))}),[])}}(n),[l,d]=(0,o.useState)(null),u=(0,o.useRef)(),p=(0,o.useRef)(""),h=(0,o.useRef)(t),[m,f]=(0,o.useState)(ke.U.both),[g,v]=(0,o.useState)(""),y=(0,o.useRef)(g),E=(0,o.useCallback)((e=>{var t;s().storage.local.set({pageTrsType:e}),f(e),null===(t=u.current)||void 0===t||t.switchShowType(e)}),[]);return(0,o.useEffect)((()=>{if(m&&l)if(t){const e=()=>{const e={message:o.createElement(at,{showType:m,onShowTypeChange:E,auto:a,onAutoChange:e=>{i(e)},apiCode:g,onAPIChange:e=>{s().storage.local.set({pageTrsApi:e}),v(e)},portalContainer:r}),timeout:0,onDismiss(){p.current="",n(!1)}};p.current?l.show(e,p.current):p.current=l.show(e)},c=t!==h.current,d=g!==y.current,b=!y.current;c||d&&!b?(d&&u.current&&(u.current.destroy(),u.current=void 0),it.isOver(0).then((t=>{t?(n(!1),l.show({action:{text:"开通会员",onClick:U.H},message:"非会员每天只能使用 3 次网页全文翻译功能，成为会员即可解除此限制。",intent:"primary",timeout:0}),i(!1)):(e(),s().storage.local.get(lt).then((({pageTrsType:e,pageTrsApi:t})=>{f(e),v(t);const n=new _e(t);u.current=function(e,t=ke.U.both){return Le()?new Re(e,t):new Ge(e,t)}((e=>new Promise(((t,r)=>n.addStream({text:e,resolve:t,reject:r})))),e)})))}))):e()}else u.current&&(u.current.destroy(),u.current=void 0),p.current&&l.dismiss(p.current),v("")}),[g,t,n,l,a,m,i,E,r]),(0,o.useEffect)((()=>{function e(e){if("page translate switch mode"===e){const e=nt.findIndex((e=>e.value===m));if(e<0)return;let t=e+1;t>=nt.length?s().storage.local.get(ct).then((({pageTrsJumpTwo:e})=>{t=e?1:0,E(nt[t].value)})):E(nt[t].value)}}return s().runtime.onMessage.addListener(e),()=>{s().runtime.onMessage.removeListener(e)}}),[m,E]),(0,o.useEffect)((()=>{h.current=t}),[t]),(0,o.useEffect)((()=>{y.current=g}),[g]),o.createElement("div",{id:"web-trs-panel"},o.createElement(c.x7,{position:"bottom-right",ref:d,className:"app-toaster-container",usePortal:!1}))}var ut=n(4194);function pt(e){const{mediaElement:t,serviceImplement:n,lang:r,onStart:s,onStop:a}=e,[i,l]=(0,o.useState)(!1),[c,d]=(0,o.useState)([]),[u,p]=(0,o.useState)(""),h=t instanceof HTMLAudioElement?"音频":"视频",m=(0,o.useRef)(!1),f=(0,o.useRef)(),g=()=>{d([]),p("")},v=(0,o.useCallback)((()=>{if(!t)return;if(i)throw new Error("识别服务正在运行，在停止前无法直接开始。");m.current=!1,l(!0),t.pause();const e=e=>{const t=(0,ut.DR)(e);window.alert(t.message),g(),l(!1),a()};n.mediaStream({mediaStream:t,lang:r,options:{onInterim:e=>{m.current||p(e)},onSentence:e=>{m.current||(p(""),d((t=>(0,B.ZP)(t,(t=>{t.push(e)})))))},onStop:e=>{if(m.current)return;g();const t=e.join("\n");t.length?a(t):a()},onError:t=>{m.current||e(t)}}}).then((e=>{m.current?e.abort():(f.current=e,t.play(),s())}),e)}),[r,t,s,a,i,n]),y=(0,o.useCallback)((()=>{var e;l(!1),null===(e=f.current)||void 0===e||e.stop(),f.current=void 0,null==t||t.pause()}),[t]),E=(0,o.useCallback)((()=>{var e;m.current=!0,l(!1),null===(e=f.current)||void 0===e||e.abort(),f.current=void 0}),[]);return(0,o.useEffect)((()=>E),[E]),{start:v,stop:y,abort:E,running:i,mediaText:h,allSentences:c,interimSentence:u}}const ht=new Te.P("videoLimit",5);let mt="";function ft(e){e.show({action:{text:"开通会员",onClick:U.H},message:`非会员每天只能翻译 ${ht.max} 个音视频，成为会员即可解除此限制。`,intent:"primary",timeout:0})}function gt(e){const{disabled:t,toaster:n}=e,{start:r,stop:s,running:a,mediaText:i,allSentences:l,interimSentence:d}=pt(e);return o.createElement("div",null,o.createElement("div",null,a&&o.createElement(c.zx,{disabled:t,icon:"stop",intent:"primary",onClick:s},"停止识别并翻译"),!a&&o.createElement(c.zx,{disabled:t,icon:"play",intent:"primary",onClick:()=>{ht.isOver().then((e=>{e?ft(n):r()}))}},"播放",i,"并开始识别")),o.createElement("div",null,l.map(((e,t)=>o.createElement("div",{key:t},e))),o.createElement("span",{style:{opacity:.6}},d)))}var vt=n(4185);function yt(e){const{disabled:t,serviceImplement:n,onStop:r,toaster:a}=e,{start:i,abort:l,running:d,mediaText:u,allSentences:p,interimSentence:h}=pt(e),m=!n.service.realtime,f=t||m,g=p[p.length-1],[v,y]=(0,o.useState)({text:"正在等待识别出一个完整的句子……",result:""});return(0,o.useEffect)((()=>{if(!g)return;let e=!1;return y({text:g,result:"正在翻译，请稍候……"}),s().runtime.sendMessage({action:"translate",data:{apiCode:"GoogleWeb",text:g}}).then((t=>{var n;if(e)return;const r=t.error?t.error.message:(null===(n=t.result)||void 0===n?void 0:n.join(""))||"没有翻译结果";y({text:g,result:r})}),(t=>{e||y({text:g,result:t.message})})),()=>{e=!0}}),[g]),o.createElement("div",null,m&&o.createElement(c.UW,{intent:"primary"},n.service.name,"不支持实时翻译功能，请选择名称中带有“实时语音识别”的服务。"),!d&&o.createElement(c.zx,{intent:"primary",icon:"play",disabled:f,onClick:()=>{ht.isOver().then((e=>{e?ft(a):i()}))}},"播放",u,"并开始实时翻译"),d&&o.createElement(o.Fragment,null,o.createElement(c.zx,{intent:"primary",icon:"stop",onClick:()=>{l(),r()}},"停止实时翻译"),o.createElement("div",{style:{position:"fixed",top:0,left:0,width:"100%",textAlign:"center",color:"white"}},o.createElement("div",{style:{width:"80%",margin:"0 auto"}},o.createElement("div",{style:{marginBottom:10,fontSize:18}},o.createElement("span",{style:{backgroundColor:"rgba(0,0,0,0.8)"}},v.text)),o.createElement("div",{style:{fontSize:24}},o.createElement("span",{style:{backgroundColor:"rgba(0,0,0,0.8)"}},v.result))))),o.createElement("div",{style:{opacity:.6}},h))}var Et=n(3281);const bt={0:"逐句翻译",1:"实时翻译"};function wt(e){const{onText:t}=e,[n]=(0,o.useState)((()=>Array.from(document.querySelectorAll("video,audio")))),[r,s]=(0,o.useState)(0),[a,i]=(0,o.useState)("0"),[l,d]=(0,o.useState)("TencentRealtime"),[u,p]=(0,o.useState)(Et.PK),[h,m]=(0,o.useState)(Et.Ty.defaultLang),[f,g]=(0,o.useState)(!1),v=vt.C[l];(0,o.useEffect)((()=>{p(vt.UR[v.service.id]),m(v.service.defaultLang)}),[v]);const y=(0,o.useCallback)((()=>{g(!0),function(){const e=window.location.href;mt!==e&&(mt=e,ht.addOne())}()}),[]),E=(0,o.useCallback)((e=>{g(!1),e&&t(e)}),[t]),b=n[r],w=!b,x="default-speech"===l,T=w||x;(0,o.useEffect)((()=>{null==b||b.pause()}),[b]);const C=b instanceof HTMLAudioElement?"音频":"视频";return o.createElement(o.Fragment,null,w&&o.createElement(c.UW,{intent:"primary",style:{marginBottom:10}},"当前页面没有视频或音频。"),x&&o.createElement(c.UW,{intent:"primary",style:{marginBottom:10}},v.service.name,"不支持音视频翻译功能，请选择其它语音服务。"),n.length>1&&o.createElement("div",null,"选择要翻译的音 / 视频：",o.createElement(c.Lu,{disabled:f,value:r,onChange:e=>{const t=Number(e.currentTarget.value);s(t)}},n.map(((e,t)=>o.createElement("option",{key:t,value:t},t))))),o.createElement(c.Ee,{inline:!0,className:"translate-type-selector",label:"翻译方式：",selectedValue:a,onChange:e=>{i(e.currentTarget.value)},disabled:f||T},Object.keys(bt).map((e=>o.createElement(c.Y8,{key:e,value:e},bt[e]))),o.createElement("a",{href:"https://hcfy.app/docs/guides/video/",target:"_blank",rel:"noreferrer"},"查看使用说明")),o.createElement("div",null,"选择要使用的语音识别服务：",o.createElement(c.Lu,{disabled:f||T,value:l,onChange:e=>{d(e.currentTarget.value)}},vt.pB.map((e=>o.createElement("option",{key:e.id,value:e.id},e.name))))),o.createElement("div",null,"选择",C,"的语种：",o.createElement(c.Lu,{disabled:f||T,value:h,onChange:e=>{m(e.currentTarget.value)}},Object.keys(u).map((e=>o.createElement("option",{key:e,value:e},u[e]))))),"0"===a&&o.createElement(gt,{toaster:e.toaster,disabled:T,mediaElement:b,serviceImplement:v,lang:h,onStart:y,onStop:E}),"1"===a&&o.createElement(yt,{toaster:e.toaster,disabled:T,mediaElement:b,serviceImplement:v,lang:h,onStart:y,onStop:E}))}function xt(e){const{show:t,onClose:n,onText:r}=e,[s,a]=(0,o.useState)(null),i=(0,o.useRef)();return(0,o.useEffect)((()=>{s&&(t?ht.isOver().then((e=>{e?(n(),ft(s)):i.current=s.show({message:o.createElement(wt,{onText:r,toaster:s}),timeout:0,onDismiss:()=>{i.current=void 0,n()}},i.current)})):i.current&&s.dismiss(i.current))}),[n,r,t,s]),o.createElement(c.x7,{position:"bottom-right",ref:a,className:"app-toaster-container",usePortal:!1})}const Tt={...(0,E.Z)(b.q,["button","disableInTextarea","domainBlackList","domainWhiteList","textList","placement","pin","pinPos","pinIgnoreDomainList","showTextArea","panelSize","modifierKeys","modifierKeyPressedAction","modifierKeyTranslate","modifierKeyLink","ocrService","panelButtons","charsLimit"]),...(0,E.Z)(b.d,["hoverTranslate"])};function Ct(e,t,n,r){return!(!e&&!n)&&!(null==r?void 0:r.some((e=>e.test(t))))}function _t(e){const{pin:t,onClick:n,size:r}=e;return o.createElement("div",{className:"switch-pin"},o.createElement(c.zx,{icon:o.createElement(c.JO,{icon:"pin",iconSize:Q[r]}),small:"small"===r,large:"large"===r,minimal:!0,active:t,onClick:n}))}const kt=new class{constructor(){this.topParsedData=null,this.activeFrameIndex=null,this.msgMap=new Map,this.listeners=null,this.topWorker=new he.U((e=>{fe("收到来自顶层 worker 发送的消息",e),this.sendMsg(e)})),this.messagePassingBetweenFrames=new me.C,this.messagePassingBetweenFrames.on("message",(e=>{const t=e;t&&(fe("收到来自 iframe worker 发送的消息",t),this.sendMsg(t))}))}sendMsg(e){var t,n,r,s,o,a,i,l,c;switch(e.type){case"HCFY_SELECTION_EVENT_MOUSEDOWN":this.clearSelectionData(),null===(t=this.listeners)||void 0===t||t.onMouseDown(e.event);break;case"HCFY_SELECTION_EVENT_RECEIVE_SELECTION_INFO":const{parsedData:d,activeFrameIndex:u}=ge(e.data);this.topParsedData=(null==d?void 0:d.isTop)?d:null,this.activeFrameIndex=u;const{reason:p}=e.meta;if("mouseup"===p)d&&(null===(n=this.listeners)||void 0===n||n.onMouseUp(d,d.mouseUpEvent));else if("hover"===p)d&&(null===(r=this.listeners)||void 0===r||r.onHoverSelection(d));else if("proactive"===p){const t=e.meta.mid;if(t){const e=this.msgMap.get(t);e&&(this.msgMap.delete(t),e(d||void 0))}}break;case"HCFY_SELECTION_EVENT_SCROLL":if(this.topParsedData)null===(s=this.listeners)||void 0===s||s.onScroll(this.topParsedData,e.event);else if(this.isTopFrameActivated()){const t=this.getInfoSync();t&&(null===(o=this.listeners)||void 0===o||o.onScroll(t,e.event))}else this.getInfo().then((t=>{var n;t&&(null===(n=this.listeners)||void 0===n||n.onScroll(t,e.event))}));break;case"HCFY_SELECTION_EVENT_ESC_KEY":this.clearSelectionData(),null===(a=this.listeners)||void 0===a||a.onEsc();break;case"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_ACTIVE":null===(i=this.listeners)||void 0===i||i.onModifierKeysActive();break;case"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_RELEASED":null===(l=this.listeners)||void 0===l||l.onModifierKeysReleased();break;case"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_INTERRUPTED":null===(c=this.listeners)||void 0===c||c.onModifierKeysInterrupted()}}isTopFrameActivated(){var e;return-1===(null===(e=this.activeFrameIndex)||void 0===e?void 0:e[0])}getInfoSync(){const e=this.topWorker.sendMsg({type:"HCFY_SELECTION_EVENT_REPORT_INFO_PROACTIVE",mid:"sync"});if(e)return ge(e.data).parsedData}getInfo(){return new Promise((e=>{if(!this.activeFrameIndex)return void e(void 0);if(this.isTopFrameActivated())return void e(this.getInfoSync());const t=(0,pe.Z)();this.msgMap.set(t,e),this.messagePassingBetweenFrames.tell({type:"HCFY_SELECTION_EVENT_REPORT_INFO_PROACTIVE",mid:t},this.isTopFrameActivated()?"top":this.activeFrameIndex.reverse().slice(1))}))}clearSelectionData(){this.topParsedData=null}sendToAllFrames(e){this.topWorker.sendMsg(e),this.messagePassingBetweenFrames.tell(e,"all")}disableLink(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_DISABLE_LINK"})}enableLink(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_ENABLE_LINK"})}enableHoverTranslate(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_ENABLE_HOVER_TRANSLATE"})}disableHoverTranslate(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_DISABLE_HOVER_TRANSLATE"})}};function St(e){const{portalContainer:t}=e,[n,r]=(0,y.Z)(Tt),i="tesseractocr"===(null==n?void 0:n.ocrService),l=null==n?void 0:n.button,d=null==n?void 0:n.domainBlackList,u=null==n?void 0:n.domainWhiteList,p=null==n?void 0:n.textList,h=(null==n?void 0:n.placement)||Tt.placement,m=n?n.pin:Tt.pin,f=n?n.pinIgnoreDomainList:Tt.pinIgnoreDomainList,g=(null==n?void 0:n.panelSize)||Tt.panelSize,v="small"===g,E="large"===g,b=(0,o.useMemo)((()=>null==p?void 0:p.reduce(((e,t)=>(t.enabled&&e.push(new RegExp(t.value)),e)),[])),[p]),w=(0,o.useCallback)((e=>{r("function"==typeof e?t=>{t.pin=e(t.pin)}:{pin:e})}),[r]),[x,T]=(0,o.useState)(null),[C,_]=(0,o.useState)(!1),k=(0,o.useRef)(null),[S,N]=(0,o.useState)(),L=n?n.hoverTranslate:Tt.hoverTranslate,[R,P]=(0,o.useState)(void 0),z=(()=>{const e=window.location.href;return!!(0,ce.ZP)(e)||(!!(m&&f&&C)||(void 0!==u&&void 0!==d?function(e,t,n){const r=le(e,t,n);return!r.urlParts||r.whiteListMatched||!r.blackListMatched}(e,d,u):void 0))})();(0,o.useEffect)((()=>{if(m){function e(){P(window.innerHeight)}return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}P(void 0)}),[m]);const A=(0,o.useRef)(null);(0,se.Z)(t),(0,se.Z)(A.current);const[F,M]=(0,o.useState)(!1),[U,Z]=(0,o.useState)(""),[D,B]=(0,o.useState)(null);async function H(){var e;const t=await kt.getInfo();t&&(N(t.range),null===(e=K.current)||void 0===e||e.translate({type:"text",text:t.text}),_(!0))}(0,o.useEffect)((()=>{if(!t)return;const e=new a.T(t,"bp3-focus-disabled");return e.start(),()=>{e.stop()}}),[t]);const W=(0,o.useRef)(C),K=(0,o.useRef)(null);async function q(){Z(await s().runtime.sendMessage({action:"take screenshot"})),M(!0)}(0,o.useEffect)((()=>(C&&!W.current&&s().storage.local.get("autoPlay").then((({autoPlay:e})=>{var t;e&&(null===(t=K.current)||void 0===t||t.play())})),()=>{W.current=C})),[C]);const Y=(0,o.useCallback)((()=>{T(null),H()}),[]);(0,o.useEffect)((()=>{s().runtime.onMessage.addListener((e=>{switch(e){case"translate":return void Y();case"getSelectionText":return kt.getInfo().then((e=>(null==e?void 0:e.text)||""));case"screenshot translate":q();break;case"hover translate":r((e=>{e.hoverTranslate=!e.hoverTranslate}));break;case"page translate":V((e=>!e));break;case"video translate":ee((e=>!e))}}))}),[Y,r]),(0,o.useEffect)((()=>{function e(){kt.enableLink(),"hover"===(null==n?void 0:n.modifierKeyPressedAction)&&r({hoverTranslate:!1})}void 0!==z&&void 0!==l&&b&&(kt.listeners={onMouseUp(e,t){if((null==n?void 0:n.disableInTextarea)&&(e.isInTextarea||e.isInContentEditable))return;if((null==n?void 0:n.charsLimit)&&e.text.length>n.charsLimit)return;const r=t&&"selection"===(null==n?void 0:n.modifierKeyPressedAction)&&(0,de.Pe)(t,n.modifierKeys);Ct(z,e.text,r||!1,b)&&(C||!l||r?H():T(e.btnPos))},onMouseDown(){T(null),m||_(!1)},onScroll(e,t){e.isTop&&(null==t?void 0:t.target)===document||N(e.isTop?Object.assign({},e.range):e.range)},onEsc(){T(null),_(!1)},onModifierKeysActive(){(null==n?void 0:n.modifierKeyLink)&&kt.disableLink(),"hover"===(null==n?void 0:n.modifierKeyPressedAction)&&r({hoverTranslate:!0})},onModifierKeysReleased(){e(),(null==n?void 0:n.modifierKeyTranslate)&&Y()},onModifierKeysInterrupted(){e()},onHoverSelection(e){Ct(!0,e.text,!1,b)&&H()}})}),[l,z,b,C,null==n?void 0:n.modifierKeyLink,null==n?void 0:n.modifierKeyPressedAction,null==n?void 0:n.modifierKeyTranslate,null==n?void 0:n.modifierKeys,null==n?void 0:n.disableInTextarea,null==n?void 0:n.charsLimit,m,Y,r]),(0,o.useEffect)((()=>{re.B||(L?kt.enableHoverTranslate():kt.disableHoverTranslate())}),[L]);const $=o.createElement(c.zx,{className:"cut-btn",onClick:q,icon:o.createElement(c.JO,{icon:"cut",iconSize:Q[g]}),small:"small"===g,large:"large"===g,minimal:!0,title:"截图翻译"}),[j,V]=(0,o.useState)(!1),J=o.createElement(c.zx,{className:"cut-btn",onClick:()=>V(!0),icon:o.createElement(c.JO,{icon:"translate",iconSize:Q[g]}),small:"small"===g,large:"large"===g,minimal:!0,title:"网页全文翻译"}),[X,ee]=(0,o.useState)(!1),te=o.createElement(c.zx,{className:"cut-btn",onClick:()=>ee(!0),icon:o.createElement(c.JO,{icon:"video",iconSize:Q[g]}),small:"small"===g,large:"large"===g,minimal:!0,title:"音视频翻译",style:{marginRight:2}});return o.createElement("div",{id:"app",ref:A},n&&o.createElement(o.Fragment,null,o.createElement(ne,{btnPos:x,setBtnPos:T,onBtnClick:Y}),o.createElement(O,{show:C,pin:m,setMaxHeight:P,setPin:w,range:S,placement:h,ref:k},o.createElement(G,{hasDragTip:!0,ref:K,style:{maxHeight:R},showOptionsTip:C,headerLeft:o.createElement(o.Fragment,null,o.createElement(_t,{pin:m,onClick:()=>{r((e=>{const t=!e.pin;e.pin=t,window.setTimeout((()=>{var e,n;t?null===(e=k.current)||void 0===e||e.switch2pin():null===(n=k.current)||void 0===n||n.clearPos()}))}))},size:g}),(null==n?void 0:n.panelButtons.includes("cut"))&&$,(null==n?void 0:n.panelButtons.includes("translate"))&&J,(null==n?void 0:n.panelButtons.includes("video"))&&te),headerRight:o.createElement(c.zx,{icon:o.createElement(c.JO,{icon:"cross",iconSize:Q[g]+4}),onClick:()=>{_(!1)},small:v,large:E,minimal:!0,title:"关闭(Esc)"}),extendOptions:o.createElement(o.Fragment,null,o.createElement(c.XZ,{inline:!0,large:E,label:"显示文本框",checked:n.showTextArea,onChange:e=>{r({showTextArea:e.target.checked})}}),o.createElement(c.XZ,{large:E,style:{marginRight:"0"},disabled:re.B,label:"鼠标悬浮取词",inline:!0,checked:L,onChange:()=>r((e=>{e.hoverTranslate=!e.hoverTranslate}))})),showTextArea:n.showTextArea,toaster:D||void 0,size:g,portalContainer:t}))),o.createElement(c.x7,{position:"top",ref:B,className:"app-toaster-container",usePortal:!1}),o.createElement(dt,{open:j,setOpen:V,portalContainer:t}),o.createElement(xe,{isShow:F,setIsShow:M,isLocalOCR:i,imgSrc:U,portalContainer:t,onText:(e,t)=>{var n;null===(n=K.current)||void 0===n||n.translate({type:"image",dataURI:e}).then((()=>{const e=window.pageXOffset,n=window.pageYOffset;N({getBoundingClientRect(){const r=t.top-(window.pageYOffset-n),s=t.left-(window.pageXOffset-e);return{top:r,left:s,width:t.width,height:t.height,right:s+t.width,bottom:r+t.height}}}),_(!0)}),I.Z)}}),o.createElement(xt,{show:X,onClose:()=>ee(!1),onText:e=>{var t;null===(t=K.current)||void 0===t||t.translate({type:"text",text:e}),_(!0)}}))}var Nt=n(7658),Lt=n.n(Nt);var Rt=n(1867);function Pt(){return o.createElement(Rt.Z,{id:"__hcfy__",stylesheetURLs:["blueprint-select.css","cropper.css"],cssText:(e=Lt(),e.replace(/url\((["']?)(.*?)\1\)/g,(function(e,t,n){return n.startsWith("data:")?e:`url(${s().runtime.getURL(n)})`})))},(e=>o.createElement(St,{portalContainer:e||void 0})));var e}},7255:(e,t,n)=>{"use strict";n.d(t,{B:()=>o,Z:()=>a});var r=n(9111);const s=document.caretPositionFromPoint?function(e,t){const n=document.caretPositionFromPoint(e,t);return n&&{offsetNode:n.offsetNode,offset:n.offset}}:document.caretRangeFromPoint?function(e,t){const n=document.caretRangeFromPoint(e,t);return n&&{offsetNode:n.startContainer,offset:n.startOffset}}:void 0;const o=!s;class a{constructor(e,t=1e3,n,o=document.body){this.destroyed=!1,this.context=o,this.onMouseMove=(0,r.Z)((t=>{n&&!t[n]||(!function(e,t){if(!s)return null;const n=window.getSelection();if(!n)return null;const r=s(e,t);if(!r)return null;const{offset:o,offsetNode:a}=r;if(a.nodeType!==Node.TEXT_NODE)return null;const i=n.rangeCount>0?n.getRangeAt(0):void 0;n.removeAllRanges();const l=document.createRange();l.setStart(a,o),l.setEnd(a,o),n.addRange(l),n.modify("move","backward","word"),n.modify("extend","forward","word");const c=n.getRangeAt(0).getBoundingClientRect();(c.left>e||c.left+c.width<e||c.top>t||c.top+c.height<t)&&(n.removeAllRanges(),i&&n.addRange(i))}(t.clientX,t.clientY),e(t))}),t),o.addEventListener("pointermove",this.onMouseMove)}destroy(){this.destroyed=!0,this.context.removeEventListener("pointermove",this.onMouseMove)}}},2852:(e,t,n)=>{"use strict";n.d(t,{oJ:()=>a,Pe:()=>l,dD:()=>c});var r=n(985),s=n(1227);const o=n.n(s)()("hotkeys"),a={ctrl:r.eE?"metaKey":"ctrlKey",alt:"altKey",shift:"shiftKey"},i={ctrl:r.eE?r.vU?[224]:[91,93]:[17],alt:[18],shift:[16]};function l(e,t){return!(!t||!t.length)&&t.every((t=>e[a[t]]))}function c(e,t,n,r){const s=new Set;let a=!1;function l(){s.clear(),a?(a=!1,o("辅助键处于激活状态，执行中断回调"),r()):o("辅助键未处于激活状态")}function c(){o("页面失去了焦点，执行中断操作"),l()}function d(n){const r=n.keyCode,c=s.size;if(!e.some((e=>{if(i[e].includes(r))return s.add(e),!0})))return o("按下了不是辅助键的其它键，执行中断操作"),void l();c!==s.size&&(o("按下了新的辅助键，当前已经按下的辅助键：",[...s]),s.size===e.length&&(o("全部辅助键已按下，将辅助键改为激活状态，并执行辅助键按下回调"),a=!0,t()))}function u(t){const r=t.keyCode,l=s.size;if(!l)return;e.some((e=>{if(i[e].includes(r))return s.delete(e),!0}))&&l!==s.size&&(o("松开了新的辅助键，当前已经按下的辅助键：",[...s]),a=!1,e.length-s.size==1&&(o("一个辅助键已松开，执行辅助键松开回调"),n()))}return window.addEventListener("keydown",d),window.addEventListener("blur",c),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",d),window.removeEventListener("blur",c),window.removeEventListener("keyup",u)}}},985:(e,t,n)=>{"use strict";n.d(t,{eE:()=>a,XO:()=>i,un:()=>l,vU:()=>c});var r=n(3150),s=n.n(r);const o=window.navigator.userAgent,a=o.includes("Mac"),i=o.includes("Chrome"),l=o.includes("Edg"),c=o.includes("Firefox");function d(e){return e.split(".").map((e=>Number(e)))}d(s().runtime.getManifest().version)},1867:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(3150),s=n.n(r),o=n(3536),a=n(3543),i=n.n(a),l=n(7294);function c(e){const{children:t,id:n,stylesheetURLs:r,cssText:a}=e,[c,d]=(0,l.useState)(null),u=(0,l.useRef)(null);return(0,l.useEffect)((()=>{const e=document.getElementById("dark-mode");if(!e)return;const t=()=>{var t;if(e.getAttribute("href")){const e=null===(t=u.current)||void 0===t?void 0:t.shadowRoot;e&&setTimeout((()=>{e.adoptedStyleSheets=[]}),800)}};t();const n=new MutationObserver(t);return n.observe(e,{attributeFilter:["href"]}),()=>{n.disconnect()}}),[]),l.createElement(o.ZP.div,{style:{all:"initial"},id:n,ref:u},l.createElement("style",null,i()),l.createElement("link",{rel:"stylesheet",href:s().runtime.getURL("normalize.css")}),l.createElement("link",{rel:"stylesheet",href:s().runtime.getURL("blueprint.css")}),null==r?void 0:r.map((e=>l.createElement("link",{key:e,rel:"stylesheet",href:s().runtime.getURL(e)}))),a&&l.createElement("style",null,a),l.createElement("div",{id:"root",ref:d,dir:"ltr"},t(c)))}},1627:(e,t,n)=>{"use strict";n.d(t,{Q:()=>s,H:()=>o});var r=n(7294);function s(e){return{h:e.scrollWidth>e.clientWidth,v:e.scrollHeight>e.clientHeight}}function o(e){const[t,n]=(0,r.useState)({v:!1,h:!1});return(0,r.useEffect)((()=>{if(!e)return;const t=()=>{n(s(e))};t();const r=new ResizeObserver(t);return r.observe(e),()=>{r.unobserve(e)}}),[e]),t}},4001:(e,t,n)=>{"use strict";n.d(t,{U:()=>r,o:()=>o});var r,s=n(7856);!function(e){e.both="both",e.source="source",e.result="result"}(r||(r={}));class o{constructor(e,t,n){this.anchor=document.createComment("hcfy-anchor"),this.result=document.createElement("hcfy-result"),this.inited=!1,this.valid=!0,this.isOnlyChild=!1,this.destroyed=!1,this.innerText="",this.translating=!1,this.translated=!1,this.translateResult="",this.inline=!1,this.showType=r.source,this.rootNode=e,this.sourceNodes=t,this.translateFn=n,function(e,t,n){const r=n.nextSibling;r?e.insertBefore(t,r):e.appendChild(t)}(e,this.anchor,t[t.length-1])}init(){this.destroyed||this.inited||(this.calcInnerText(),this.valid=function(e){const t=e.trim();return!!t&&!/^[0-9\s.\-_#:()!•+~@$%^&*\n\/`]+$/.test(t)}(this.innerText),this.valid||this.destroy(),this.inited=!0)}calcInnerText(){const{sourceNodes:e,rootNode:t}=this;let n;if(this.isOnlyChild){const e=this.showType;this.switchShowType(r.source),n=function(e){if(e instanceof HTMLElement)return e.innerText;const t=document.createElement("hcfy-result");Array.from(e.childNodes).forEach((e=>{t.appendChild(e)})),e.appendChild(t);const n=t.innerText;return e.removeChild(t),Array.from(t.childNodes).forEach((t=>{e.appendChild(t)})),n}(t).trim(),this.switchShowType(e)}else{const t=document.createElement("span");e.forEach((e=>{t.appendChild(e)})),document.documentElement.appendChild(t),n=t.innerText.trim(),document.documentElement.removeChild(t),this.showType!==r.result&&this.appendSourceNodes()}this.innerText=n}setOnlyChild(){if(this.destroyed)return;const{rootNode:e}=this;this.isOnlyChild=!0,this.inited&&this.calcInnerText(),e instanceof Element&&("span"===e.nodeName.toLowerCase()||function(e,t,n=3){let r=e,s=0;do{if(s+=1,r.matches(t))return r;if(s===n)return null;r=r.parentElement}while(r);return null}(e,"a, button, [role=button], h1,h2,h3,h4,h5,h6"))&&(this.inline=!0,this.inited&&this.renderResult())}destroy(){this.switchShowType(r.source);try{this.rootNode.removeChild(this.anchor)}catch(e){}this.destroyed=!0}renderResult(e,t=!1){const{result:n}=this;this.showType===r.both?n.className="__hcfy__result__both__":this.showType===r.result?n.className="__hcfy__result__result__":n.className="__hcfy__result__source__",this.translating&&n.classList.add("__hcfy__result__loading__"),this.translated&&n.classList.add("__hcfy__result__loaded__"),this.inline&&n.classList.add("__hcfy__result__inline__");const o=e||(this.translating?"正在翻译……":this.translateResult);t?n.innerHTML=(0,s.sanitize)(o,{ALLOWED_TAGS:["a","#text","b","i"],ALLOWED_ATTR:["target","rel","href","class"]}):n.textContent=o}async translate(){if(this.inited||this.init(),this.destroyed||!this.innerText)return;if(this.translating||this.translated)return;let e;this.translating=!0,this.renderResult();try{e=await this.translateFn(this.innerText)}catch(e){return this.translating=!1,this.translated=!0,void this.renderResult("翻译结果时出错。错误信息："+e.message,!0)}if(this.translating=!1,null==e)return this.translate();this.translated=!0,this.translateResult=e,this.renderResult()}removeSourceNodes(){const{rootNode:e,sourceNodes:t}=this;t.forEach((t=>{try{e.removeChild(t)}catch(e){}}))}appendSourceNodes(){const{rootNode:e,result:t}=this,n=e.contains(t)?t:this.anchor;this.sourceNodes.forEach((t=>{try{e.insertBefore(t,n)}catch(e){}}))}appendResult(){try{this.rootNode.insertBefore(this.result,this.anchor)}catch(e){}}removeResult(){try{this.rootNode.removeChild(this.result)}catch(e){}}switchShowType(e){if(this.destroyed||e===this.showType)return;const t=this.showType;switch(this.showType=e,e){case r.source:t===r.result&&this.appendSourceNodes(),this.removeResult();break;case r.result:this.renderResult(),this.removeSourceNodes(),t===r.source&&this.appendResult();break;case r.both:this.renderResult(),t===r.source?this.appendResult():this.appendSourceNodes();break;default:throw this.showType=t,new TypeError(`不支持的显示类型：${e}`)}}}},488:(e,t,n)=>{"use strict";function r(e,t=!0){return(t?e.slice(1):e).split("&").reduce(((e,t)=>{const[n,r]=t.split("=");return e[n]=r?decodeURIComponent(r):"",e}),{})}n.d(t,{q:()=>r})}}]);